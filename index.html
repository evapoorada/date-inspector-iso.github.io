<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Date Inspector</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;600&family=Barlow+Condensed:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:       #0e0f11;
      --surface:  #16181d;
      --border:   #2a2d35;
      --accent:   #e8ff47;
      --accent2:  #47c8ff;
      --muted:    #555a68;
      --text:     #d4d8e2;
      --label:    #888da0;
      --mono:     'IBM Plex Mono', monospace;
      --cond:     'Barlow Condensed', sans-serif;
      --q1:       #e8ff47;
      --q2:       #47c8ff;
      --q3:       #ff9f47;
      --q1-dim:   rgba(232,255,71,.07);
      --q2-dim:   rgba(71,200,255,.07);
      --q3-dim:   rgba(255,159,71,.07);
      --q1-mid:   rgba(232,255,71,.15);
      --q2-mid:   rgba(71,200,255,.15);
      --q3-mid:   rgba(255,159,71,.15);
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--mono);
      min-height: 100vh;
      background-image:
        linear-gradient(rgba(255,255,255,.015) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.015) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    .shell {
      max-width: 1100px;
      margin: 0 auto;
      padding: 2rem 1.5rem 4rem;
    }

    /* ── Header ── */
    header {
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border);
    }
    .header-inner { border-left: 3px solid var(--accent); padding-left: 1rem; }
    .header-inner .eyebrow {
      font-size: .6rem; letter-spacing: .25em; color: var(--accent);
      text-transform: uppercase; margin-bottom: .3rem;
    }
    .header-inner h1 {
      font-family: var(--cond); font-size: 2.2rem; font-weight: 700;
      letter-spacing: .04em; line-height: 1; color: #fff;
    }
    .header-inner p { margin-top: .4rem; font-size: .68rem; color: var(--label); line-height: 1.6; }

    /* ── Tabs ── */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      margin-bottom: 2rem;
    }
    .tab-btn {
      background: none; border: none;
      border-bottom: 2px solid transparent; margin-bottom: -1px;
      font-family: var(--cond); font-size: .95rem; font-weight: 500;
      letter-spacing: .08em; text-transform: uppercase;
      color: var(--muted); padding: .6rem 1.4rem;
      cursor: pointer; transition: color .15s, border-color .15s;
    }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* ══════════════════════════════
       TAB 1 — INSPECTOR
    ══════════════════════════════ */
    .inspector-wrap { max-width: 620px; }

    .input-wrap { display: flex; gap: .75rem; margin-bottom: 1.5rem; }

    input[type="date"] {
      flex: 1; background: var(--surface); border: 1px solid var(--border);
      color: var(--text); font-family: var(--mono); font-size: .9rem;
      padding: .85rem 1rem; outline: none; transition: border-color .2s;
      appearance: none; -webkit-appearance: none; color-scheme: dark;
    }
    input[type="date"]:focus { border-color: var(--accent); }

    .btn-analyze {
      background: var(--accent); color: #0e0f11; border: none;
      font-family: var(--cond); font-size: 1rem; font-weight: 700;
      letter-spacing: .1em; text-transform: uppercase;
      padding: .85rem 1.5rem; cursor: pointer;
      transition: background .15s, transform .1s;
      white-space: nowrap;
    }
    .btn-analyze:hover  { background: #f5ff7a; }
    .btn-analyze:active { transform: scale(.97); }

    .error-msg {
      width: 100%; background: #2a1010; border: 1px solid #5a1a1a;
      color: #ff7b7b; font-size: .75rem; padding: .75rem 1rem;
      margin-bottom: 1rem; display: none;
    }
    .error-msg.show { display: block; }

    .echo {
      display: flex; align-items: center; gap: .75rem;
      margin-bottom: 1.2rem; opacity: 0; transition: opacity .3s;
    }
    .echo.visible { opacity: 1; }
    .echo .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); flex-shrink: 0; }
    .echo span { font-size: .72rem; color: var(--label); }
    .echo strong { color: var(--text); font-weight: 600; }

    .results {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 1px; background: var(--border); border: 1px solid var(--border);
      opacity: 0; transform: translateY(12px);
      transition: opacity .35s ease, transform .35s ease; pointer-events: none;
    }
    .results.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }

    .card { background: var(--surface); padding: 1.25rem 1.4rem; position: relative; overflow: hidden; }
    .card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0;
      height: 2px; background: var(--border);
    }
    .card.accent-week::before    { background: var(--accent); }
    .card.accent-month::before   { background: var(--accent2); }
    .card.accent-year::before    { background: #ff7eb3; }
    .card.accent-quarter::before { background: var(--q3); }
    .card.full { grid-column: span 2; }

    .card .tag   { font-size: .6rem; letter-spacing: .2em; text-transform: uppercase; color: var(--label); margin-bottom: .5rem; }
    .card .value { font-family: var(--mono); font-size: 1.7rem; font-weight: 600; line-height: 1; margin-bottom: .3rem; word-break: break-all; color: #fff; }
    .card.accent-week    .value { color: var(--accent); }
    .card.accent-month   .value { color: var(--accent2); }
    .card.accent-year    .value { color: #ff7eb3; }
    .card.accent-quarter .value { color: var(--q3); }
    .card .sub { font-size: .7rem; color: var(--muted); margin-top: .15rem; }

    .q-badge {
      display: inline-block; font-family: var(--cond); font-size: 4rem; font-weight: 700;
      color: rgba(255,159,71,.12); position: absolute; right: 1rem; top: 50%;
      transform: translateY(-50%); pointer-events: none;
    }

    @keyframes pop {
      0%   { transform: scale(.9); opacity: 0; }
      60%  { transform: scale(1.04); }
      100% { transform: scale(1); opacity: 1; }
    }
    .card { animation: none; }
    .results.visible .card                  { animation: pop .3s ease forwards; }
    .results.visible .card:nth-child(2)     { animation-delay: .05s; }
    .results.visible .card:nth-child(3)     { animation-delay: .10s; }
    .results.visible .card:nth-child(4)     { animation-delay: .15s; }

    /* ══════════════════════════════
       RANGE SECTION
    ══════════════════════════════ */
    .range-section { max-width: 620px; margin-top: 2.5rem; }

    .range-section-title {
      font-family: var(--cond); font-size: .7rem; letter-spacing: .22em;
      text-transform: uppercase; color: var(--muted);
      margin-bottom: 1rem; padding-bottom: .5rem;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: .6rem;
    }
    .range-section-title::before {
      content: ''; display: inline-block;
      width: 8px; height: 8px; background: var(--accent2); border-radius: 2px;
    }

    .range-inputs {
      display: grid;
      grid-template-columns: 1fr auto 1fr auto;
      gap: .6rem; align-items: stretch; margin-bottom: 1rem;
    }
    .range-arrow {
      display: flex; align-items: center; justify-content: center;
      color: var(--muted); font-size: .85rem; padding: 0 .15rem; user-select: none;
    }

    .range-error {
      width: 100%; background: #2a1010; border: 1px solid #5a1a1a;
      color: #ff7b7b; font-size: .75rem; padding: .75rem 1rem;
      margin-bottom: 1rem; display: none;
    }
    .range-error.show { display: block; }

    /* Summary strip */
    .range-summary {
      display: flex; gap: 1px;
      background: var(--border); border: 1px solid var(--border);
      margin-bottom: 1px;
      font-size: .7rem; opacity: 0; transition: opacity .25s;
    }
    .range-summary.visible { opacity: 1; }
    .rs-pill {
      flex: 1; background: var(--surface); padding: .6rem .9rem;
      display: flex; flex-direction: column; gap: .15rem;
    }
    .rs-pill .rsp-label { font-size: .55rem; letter-spacing: .15em; text-transform: uppercase; color: var(--muted); }
    .rs-pill .rsp-val   { font-family: var(--cond); font-size: 1.3rem; font-weight: 700; line-height: 1; }
    .rs-pill.sp-weeks  .rsp-val { color: var(--accent); }
    .rs-pill.sp-from   .rsp-val { color: var(--text); font-family: var(--mono); font-size: .85rem; }
    .rs-pill.sp-to     .rsp-val { color: var(--text); font-family: var(--mono); font-size: .85rem; }

    /* Week list */
    .week-list-wrap {
      border: 1px solid var(--border); border-top: none;
      opacity: 0; transform: translateY(6px);
      transition: opacity .3s, transform .3s;
      max-height: 320px; display: flex; flex-direction: column;
    }
    .week-list-wrap.visible { opacity: 1; transform: translateY(0); }

    .week-list-header {
      display: grid; grid-template-columns: 1.4fr 1fr 1fr 1fr;
      background: #0c0d0f; border-bottom: 1px solid var(--border);
      padding: .45rem 1rem; position: sticky; top: 0;
      font-size: .58rem; letter-spacing: .15em; text-transform: uppercase; color: var(--muted);
    }

    .week-list { overflow-y: auto; flex: 1; }
    .week-list::-webkit-scrollbar { width: 4px; }
    .week-list::-webkit-scrollbar-track { background: var(--bg); }
    .week-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

    .wl-row {
      display: grid; grid-template-columns: 1.4fr 1fr 1fr 1fr;
      padding: .5rem 1rem; border-bottom: 1px solid rgba(255,255,255,.04);
      font-size: .72rem; align-items: center;
      transition: background .1s;
    }
    .wl-row:last-child { border-bottom: none; }
    .wl-row:hover { background: rgba(255,255,255,.04); }
    .wl-row.wl-first { border-top: 2px solid var(--accent); }
    .wl-row.wl-last  { border-bottom: 2px solid var(--accent2) !important; }
    .wl-row.q1-row { background: var(--q1-dim); }
    .wl-row.q2-row { background: var(--q2-dim); }
    .wl-row.q3-row { background: var(--q3-dim); }
    .wl-row.q1-row:hover { background: var(--q1-mid); }
    .wl-row.q2-row:hover { background: var(--q2-mid); }
    .wl-row.q3-row:hover { background: var(--q3-mid); }

    .wl-week { font-weight: 600; color: #fff; font-size: .78rem; }
    .wl-year { color: var(--label); }
    .wl-month { }
    .wl-quarter { font-family: var(--cond); font-weight: 700; font-size: .9rem; }
    .q1-row .wl-month, .q1-row .wl-quarter { color: var(--q1); }
    .q2-row .wl-month, .q2-row .wl-quarter { color: var(--q2); }
    .q3-row .wl-month, .q3-row .wl-quarter { color: var(--q3); }

    /* Footer with copy button */
    .week-list-footer {
      display: flex; align-items: center; gap: .8rem;
      padding: .5rem 1rem; background: #0c0d0f;
      border-top: 1px solid var(--border);
    }
    .btn-copy {
      background: none; border: 1px solid var(--border);
      color: var(--label); font-family: var(--mono); font-size: .65rem;
      letter-spacing: .06em; padding: .35rem .8rem;
      cursor: pointer; transition: border-color .15s, color .15s;
    }
    .btn-copy:hover { border-color: var(--accent); color: var(--accent); }
    .copy-ok {
      font-size: .65rem; color: var(--accent); opacity: 0;
      transition: opacity .2s;
    }
    .copy-ok.show { opacity: 1; }

    /* ══════════════════════════════
       TAB 3 — ISO TOOLS
    ══════════════════════════════ */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      max-width: 1000px;
    }

    .tool-card {
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 1.2rem;
      display: flex;
      flex-direction: column;
      gap: .8rem;
    }
    .tool-card-title {
      font-family: var(--cond);
      font-size: .8rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: var(--accent);
      font-weight: 600;
      padding-bottom: .5rem;
      border-bottom: 1px solid var(--border);
    }

    /* Week picker visual */
    .week-picker-cal {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      font-size: .65rem;
    }
    .wp-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #1a1c22;
      cursor: pointer;
      transition: background .1s;
      font-size: .7rem;
      color: var(--label);
    }
    .wp-day:hover { background: #242630; }
    .wp-day.wp-selected { background: var(--accent); color: #000; font-weight: 600; }
    .wp-day.wp-other-month { opacity: .3; }
    .wp-header {
      font-size: .55rem;
      text-transform: uppercase;
      color: var(--muted);
      padding: .3rem 0;
      text-align: center;
      letter-spacing: .08em;
    }
    .wp-controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: .5rem;
      align-items: center;
    }
    .wp-month-label {
      font-family: var(--cond);
      font-size: .9rem;
      font-weight: 600;
      color: var(--text);
    }
    .wp-nav {
      background: none;
      border: 1px solid var(--border);
      color: var(--label);
      cursor: pointer;
      padding: .2rem .5rem;
      font-size: .7rem;
      transition: all .15s;
    }
    .wp-nav:hover { border-color: var(--accent); color: var(--accent); }
    .wp-result {
      font-size: .68rem;
      color: var(--label);
      margin-top: .5rem;
      padding: .5rem;
      background: #0c0d0f;
      border-left: 2px solid var(--accent);
      display: none;
    }
    .wp-result.show { display: block; }
    .wp-result strong { color: var(--accent); }

    /* Boundary weeks */
    .boundary-list {
      max-height: 180px;
      overflow-y: auto;
      font-size: .68rem;
    }
    .boundary-item {
      padding: .5rem;
      border-bottom: 1px solid rgba(255,255,255,.04);
      display: flex;
      flex-direction: column;
      gap: .2rem;
    }
    .boundary-item:last-child { border-bottom: none; }
    .bi-week { font-weight: 600; color: var(--accent); }
    .bi-detail { color: var(--muted); font-size: .62rem; }

    /* Shortcuts */
    .shortcut-btns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: .5rem;
    }
    .btn-shortcut {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--label);
      font-size: .68rem;
      padding: .5rem .7rem;
      cursor: pointer;
      transition: all .15s;
      text-align: left;
    }
    .btn-shortcut:hover { border-color: var(--accent); color: var(--accent); }

    /* Inverse calculator */
    .inverse-input {
      display: flex;
      gap: .5rem;
    }
    .inverse-input input {
      flex: 1;
      background: #1a1c22;
      border: 1px solid var(--border);
      color: var(--text);
      font-family: var(--mono);
      font-size: .75rem;
      padding: .5rem .7rem;
      outline: none;
    }
    .inverse-input input:focus { border-color: var(--accent); }
    .inverse-result {
      margin-top: .6rem;
      padding: .6rem;
      background: #0c0d0f;
      border-left: 2px solid var(--accent2);
      font-size: .68rem;
      display: none;
    }
    .inverse-result.show { display: block; }
    .inverse-result .ir-label { color: var(--muted); font-size: .58rem; margin-bottom: .3rem; }
    .inverse-result .ir-value { color: var(--text); font-weight: 600; }

    /* Validator */
    .validator-textarea {
      width: 100%;
      background: #1a1c22;
      border: 1px solid var(--border);
      color: var(--text);
      font-family: var(--mono);
      font-size: .7rem;
      padding: .6rem;
      outline: none;
      resize: vertical;
      min-height: 80px;
    }
    .validator-textarea:focus { border-color: var(--accent); }
    .validator-result {
      margin-top: .6rem;
      font-size: .68rem;
      display: none;
    }
    .validator-result.show { display: block; }
    .vr-section {
      padding: .5rem;
      margin-bottom: .5rem;
      border-left: 2px solid;
    }
    .vr-section.vr-valid { border-color: var(--accent); background: rgba(232,255,71,.05); }
    .vr-section.vr-invalid { border-color: #ff7b7b; background: rgba(255,123,123,.05); }
    .vr-section.vr-info { border-color: var(--accent2); background: rgba(71,200,255,.05); }
    .vr-title { font-weight: 600; margin-bottom: .3rem; }
    .vr-list { color: var(--muted); font-size: .62rem; list-style: none; }
    .vr-list li { padding: .15rem 0; }

    /* Year week count */
    .ywc-table {
      width: 100%;
      font-size: .7rem;
      border-collapse: collapse;
    }
    .ywc-table td, .ywc-table th {
      padding: .4rem .6rem;
      border-bottom: 1px solid rgba(255,255,255,.04);
      text-align: left;
    }
    .ywc-table th {
      font-weight: 600;
      color: var(--muted);
      font-size: .6rem;
      letter-spacing: .1em;
      text-transform: uppercase;
    }
    .ywc-53 { color: var(--accent); font-weight: 600; }

    /* ══════════════════════════════
       TAB 2 — CALENDAR
    ══════════════════════════════ */
    .cal-toolbar {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;
    }
    .cal-year-tabs { display: flex; }
    .cal-year-btn {
      background: var(--surface); border: 1px solid var(--border);
      color: var(--muted); font-family: var(--cond); font-size: 1.1rem;
      font-weight: 700; letter-spacing: .06em; padding: .5rem 1.3rem;
      cursor: pointer; transition: all .15s;
    }
    .cal-year-btn:first-child { border-right: none; }
    .cal-year-btn.active { background: var(--accent); color: #0e0f11; border-color: var(--accent); }
    .cal-year-btn:not(.active):hover { color: var(--text); }

    .legend { display: flex; gap: 1.2rem; flex-wrap: wrap; align-items: center; }
    .legend-item { display: flex; align-items: center; gap: .4rem; font-size: .65rem; letter-spacing: .1em; text-transform: uppercase; color: var(--label); }
    .legend-dot  { width: 10px; height: 10px; border-radius: 2px; flex-shrink: 0; }
    .legend-dot.q1 { background: var(--q1); }
    .legend-dot.q2 { background: var(--q2); }
    .legend-dot.q3 { background: var(--q3); }

    .cal-table-wrap { overflow-x: auto; border: 1px solid var(--border); }

    .cal-table {
      width: 100%; border-collapse: collapse;
      font-size: .72rem; min-width: 680px;
    }
    .cal-table thead th {
      background: #0c0d0f; color: var(--label);
      font-family: var(--cond); font-size: .68rem; font-weight: 500;
      letter-spacing: .18em; text-transform: uppercase;
      padding: .65rem 1rem; text-align: left;
      border-bottom: 1px solid var(--border);
      white-space: nowrap;
    }

    .cal-table tbody tr { border-bottom: 1px solid rgba(255,255,255,.04); transition: background .1s; }
    .cal-table tbody tr:last-child { border-bottom: none; }

    /* Quarter row backgrounds */
    .cal-table tbody tr.q1-row { background: var(--q1-dim); }
    .cal-table tbody tr.q2-row { background: var(--q2-dim); }
    .cal-table tbody tr.q3-row { background: var(--q3-dim); }
    .cal-table tbody tr.q1-row:hover { background: var(--q1-mid); }
    .cal-table tbody tr.q2-row:hover { background: var(--q2-mid); }
    .cal-table tbody tr.q3-row:hover { background: var(--q3-mid); }

    /* Quarter start separator */
    .cal-table tbody tr.q1-start td { border-top: 2px solid var(--q1) !important; }
    .cal-table tbody tr.q2-start td { border-top: 2px solid var(--q2) !important; }
    .cal-table tbody tr.q3-start td { border-top: 2px solid var(--q3) !important; }

    /* Today */
    .cal-table tbody tr.today-row { outline: 1px solid rgba(232,255,71,.3); outline-offset: -1px; }
    .cal-table tbody tr.today-row td { background: rgba(232,255,71,.05) !important; }

    .cal-table td { padding: .55rem 1rem; vertical-align: middle; white-space: nowrap; }

    .td-week-num {
      font-family: var(--cond); font-size: 1rem; font-weight: 700;
      letter-spacing: .04em; color: #fff;
    }
    .td-week-iso { font-size: .58rem; color: var(--muted); display: block; margin-bottom: 1px; letter-spacing: .08em; }
    .today-row .td-week-num::after { content: ' ◀'; font-size: .6rem; color: var(--accent); font-weight: 400; }

    .td-range { color: var(--label); font-size: .7rem; }
    .td-thu   { color: var(--muted); font-size: .7rem; }

    .td-month { font-weight: 600; font-size: .78rem; }
    .q1-row .td-month { color: var(--q1); }
    .q2-row .td-month { color: var(--q2); }
    .q3-row .td-month { color: var(--q3); }
    .td-month-name { font-size: .62rem; color: var(--muted); font-weight: 400; margin-left: .3rem; }

    .td-quarter { font-family: var(--cond); font-size: 1.05rem; font-weight: 700; letter-spacing: .05em; }
    .q1-row .td-quarter { color: var(--q1); }
    .q2-row .td-quarter { color: var(--q2); }
    .q3-row .td-quarter { color: var(--q3); }

    footer {
      margin-top: 3rem; padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      font-size: .58rem; color: var(--muted); letter-spacing: .1em; text-align: center;
    }
  </style>
</head>
<body>
<div class="shell">

  <header>
    <div class="header-inner">
      <div class="eyebrow">// dayjs · ISO 8601</div>
      <h1>Date Inspector</h1>
      <p>Semana ISO · Mes · Año · Quarter personalizado (3Q × 4 meses, desde enero)</p>
    </div>
  </header>

  <div class="tabs">
    <button class="tab-btn active" data-tab="inspector">① Inspector</button>
    <button class="tab-btn" data-tab="calendar">② Calendario de semanas</button>
    <button class="tab-btn" data-tab="tools">③ Herramientas ISO</button>
  </div>

  <!-- ══ TAB 1 ══ -->
  <div class="tab-panel active" id="panel-inspector">
    <div class="inspector-wrap">

      <div class="input-wrap">
        <input type="date" id="dateInput" />
        <button class="btn-analyze" id="btnAnalyze">Analizar →</button>
      </div>

      <div class="error-msg" id="errorMsg"></div>

      <div class="echo" id="echo">
        <div class="dot"></div>
        <span>Analizando: <strong id="echoDate"></strong></span>
      </div>

      <div class="results" id="results">
        <div class="card accent-week">
          <div class="tag">// Semana ISO</div>
          <div class="value" id="rWeek">—</div>
          <div class="sub"  id="rWeekSub">—</div>
        </div>
        <div class="card accent-month">
          <div class="tag">// Mes ISO</div>
          <div class="value" id="rMonth">—</div>
          <div class="sub"  id="rMonthSub">—</div>
        </div>
        <div class="card accent-year">
          <div class="tag">// Año ISO</div>
          <div class="value" id="rYear">—</div>
          <div class="sub"  id="rYearSub">—</div>
        </div>
        <div class="card accent-quarter full">
          <div class="tag">// Quarter custom</div>
          <div class="value" id="rQuarter">—</div>
          <div class="sub"  id="rQuarterSub">—</div>
          <span class="q-badge" id="qBadge"></span>
        </div>
      </div>

      <!-- ── Range comparison ── -->
      <div class="range-section">
        <div class="range-section-title">Semanas ISO entre dos fechas</div>

        <div class="range-inputs">
          <input type="date" id="rangeFrom" />
          <div class="range-arrow">→</div>
          <input type="date" id="rangeTo" />
          <button class="btn-analyze" id="btnRange">Ver →</button>
        </div>

        <div class="range-error" id="rangeError"></div>

        <!-- summary strip -->
        <div class="range-summary" id="rangeSummary"></div>

        <!-- week list -->
        <div class="week-list-wrap" id="weekListWrap">
          <div class="week-list-header">
            <span>Semana ISO</span>
            <span>Año ISO</span>
            <span>Mes ISO</span>
            <span>Quarter</span>
          </div>
          <div class="week-list" id="weekList"></div>
          <!-- copy button -->
          <div class="week-list-footer">
            <button class="btn-copy" id="btnCopy">⎘ Copiar JSON</button>
            <span class="copy-ok" id="copyOk">✓ Copiado</span>
          </div>
        </div>
      </div><!-- /range-section -->

    </div>
  </div>

  <!-- ══ TAB 2 ══ -->
  <div class="tab-panel" id="panel-calendar">

    <div class="cal-toolbar">
      <div class="cal-year-tabs">
        <button class="cal-year-btn active" data-year="2026">2026</button>
        <button class="cal-year-btn"        data-year="2027">2027</button>
      </div>
      <div class="legend">
        <div class="legend-item"><div class="legend-dot q1"></div>Q1 · Ene – Abr</div>
        <div class="legend-item"><div class="legend-dot q2"></div>Q2 · May – Ago</div>
        <div class="legend-item"><div class="legend-dot q3"></div>Q3 · Sep – Dic</div>
      </div>
    </div>

    <div class="cal-table-wrap">
      <table class="cal-table">
        <thead>
          <tr>
            <th>Semana ISO</th>
            <th>Rango (Lun – Dom)</th>
            <th>Jueves (ref.)</th>
            <th>Mes ISO</th>
            <th>Quarter</th>
          </tr>
        </thead>
        <tbody id="calBody"></tbody>
      </table>
    </div>

  </div>

  <!-- ══ TAB 3 — ISO TOOLS ══ -->
  <div class="tab-panel" id="panel-tools">

    <div class="tools-grid">

      <!-- 1. Week picker visual -->
      <div class="tool-card">
        <div class="tool-card-title">① Week Picker Visual</div>
        <div class="wp-controls">
          <button class="wp-nav" id="wpPrev">‹</button>
          <span class="wp-month-label" id="wpMonthLabel">—</span>
          <button class="wp-nav" id="wpNext">›</button>
        </div>
        <div class="week-picker-cal" id="wpCal"></div>
        <div class="wp-result" id="wpResult"></div>
      </div>

      <!-- 2. Boundary weeks -->
      <div class="tool-card">
        <div class="tool-card-title">② Boundary Weeks Analyzer</div>
        <input type="number" id="boundYear" value="2026" min="2020" max="2030" 
          style="background:#1a1c22;border:1px solid var(--border);color:var(--text);padding:.5rem;font-size:.75rem;width:100%;margin-bottom:.5rem;">
        <div class="boundary-list" id="boundaryList"></div>
      </div>

      <!-- 3. Week range shortcuts -->
      <div class="tool-card">
        <div class="tool-card-title">③ Week Range Shortcuts</div>
        <div class="shortcut-btns">
          <button class="btn-shortcut" data-range="thisMonth">Este mes ISO</button>
          <button class="btn-shortcut" data-range="q1">Q1 completo</button>
          <button class="btn-shortcut" data-range="q2">Q2 completo</button>
          <button class="btn-shortcut" data-range="q3">Q3 completo</button>
          <button class="btn-shortcut" data-range="last4">Últimas 4 sem.</button>
          <button class="btn-shortcut" data-range="next12">Próximas 12 sem.</button>
        </div>
        <div style="font-size:.62rem;color:var(--muted);margin-top:.6rem;">
          Auto-rellena el selector de rango del Tab ①
        </div>
      </div>

      <!-- 4. ISO week calculator inverso -->
      <div class="tool-card">
        <div class="tool-card-title">④ ISO Week → Dates</div>
        <div class="inverse-input">
          <input type="text" id="inverseInput" placeholder="2026-W18" />
          <button class="btn-analyze" style="padding:.5rem 1rem;font-size:.7rem;" id="inverseGo">→</button>
        </div>
        <div class="inverse-result" id="inverseResult"></div>
      </div>

      <!-- 5. Validator -->
      <div class="tool-card">
        <div class="tool-card-title">⑤ Validador de Semanas</div>
        <textarea class="validator-textarea" id="validatorInput" placeholder="2026-W01&#10;2026-W02&#10;2026-W03&#10;..."></textarea>
        <button class="btn-analyze" style="width:100%;font-size:.7rem;" id="validatorGo">Validar</button>
        <div class="validator-result" id="validatorResult"></div>
      </div>

      <!-- 6. Year week count -->
      <div class="tool-card">
        <div class="tool-card-title">⑥ Year Week Count</div>
        <table class="ywc-table" id="ywcTable"></table>
      </div>

    </div><!-- /tools-grid -->

  </div><!-- /panel-tools -->

  <footer>DATE INSPECTOR · DAYJS · ISO 8601 · CUSTOM 3-QUARTER SYSTEM</footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/isoWeek.js"></script>

<script>
  dayjs.extend(window.dayjs_plugin_isoWeek);

  /* ───── Shared helpers ───── */
  const MONTH_NAMES = ['','Enero','Febrero','Marzo','Abril','Mayo','Junio',
                       'Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
  const MONTH_SHORT = ['','Ene','Feb','Mar','Abr','May','Jun',
                       'Jul','Ago','Sep','Oct','Nov','Dic'];
  const DAY_FULL    = ['Domingo','Lunes','Martes','Miércoles','Jueves','Viernes','Sábado'];

  function getQ(d) {
    const m = d.month() + 1;
    if (m <= 4) return { label:'Q1', range:'Enero – Abril',           cls:'q1' };
    if (m <= 8) return { label:'Q2', range:'Mayo – Agosto',           cls:'q2' };
    return             { label:'Q3', range:'Septiembre – Diciembre',   cls:'q3' };
  }

  /* ───── Tab switching ───── */
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('panel-' + btn.dataset.tab).classList.add('active');
    });
  });

  /* ───── Tab 1 — Inspector ───── */
  function analyze() {
    const raw       = document.getElementById('dateInput').value;
    const errorEl   = document.getElementById('errorMsg');
    const resultsEl = document.getElementById('results');
    const echoEl    = document.getElementById('echo');

    errorEl.classList.remove('show');
    resultsEl.classList.remove('visible');
    echoEl.classList.remove('visible');

    if (!raw) {
      errorEl.textContent = 'Por favor, introduce una fecha.';
      errorEl.classList.add('show');
      return;
    }
    const d = dayjs(raw);
    if (!d.isValid()) {
      errorEl.textContent = 'Fecha inválida.';
      errorEl.classList.add('show');
      return;
    }

    const isoYear    = d.isoWeekYear();
    const isoWeekNum = d.isoWeek();
    const weekday    = d.day();
    const thursday   = d.isoWeekday(4);
    const refMonth   = thursday.month() + 1;
    const refYear    = thursday.year();
    const qInfo      = getQ(thursday);
    const inputMonth = d.month() + 1;
    const cross      = inputMonth !== refMonth;

    document.getElementById('echoDate').textContent =
      `${DAY_FULL[weekday]}, ${d.date()} de ${MONTH_NAMES[inputMonth]} de ${d.year()}`;

    document.getElementById('rWeek').textContent    = `${isoYear}-W${String(isoWeekNum).padStart(2,'0')}`;
    document.getElementById('rWeekSub').textContent = `${DAY_FULL[weekday]}, semana ${isoWeekNum} de ${isoYear}`;

    document.getElementById('rMonth').textContent    = `${refYear}-${String(refMonth).padStart(2,'0')}`;
    document.getElementById('rMonthSub').textContent = cross
      ? `${MONTH_NAMES[refMonth]} ${refYear} (por jueves ${thursday.date()}/${refMonth})`
      : `${MONTH_NAMES[refMonth]} ${refYear}`;

    document.getElementById('rYear').textContent    = String(isoYear);
    document.getElementById('rYearSub').textContent = 'Año ISO de la semana';

    document.getElementById('rQuarter').textContent    = `${isoYear}-${qInfo.label}`;
    document.getElementById('rQuarterSub').textContent = cross
      ? `${qInfo.range} (por jueves ${thursday.date()}/${refMonth})`
      : qInfo.range;
    document.getElementById('qBadge').textContent = qInfo.label;

    resultsEl.classList.remove('visible');
    void resultsEl.offsetWidth;
    echoEl.classList.add('visible');
    setTimeout(() => resultsEl.classList.add('visible'), 50);
  }

  document.getElementById('btnAnalyze').addEventListener('click', analyze);
  document.getElementById('dateInput').addEventListener('keydown', e => { if (e.key === 'Enter') analyze(); });
  document.getElementById('dateInput').value = dayjs().format('YYYY-MM-DD');

  /* ───── Tab 1 — Range → week list ───── */
  function analyzeRange() {
    const rawFrom = document.getElementById('rangeFrom').value;
    const rawTo   = document.getElementById('rangeTo').value;
    const errEl   = document.getElementById('rangeError');
    const sumEl   = document.getElementById('rangeSummary');
    const wrapEl  = document.getElementById('weekListWrap');
    const listEl  = document.getElementById('weekList');

    errEl.classList.remove('show');
    sumEl.classList.remove('visible');
    wrapEl.classList.remove('visible');
    listEl.innerHTML = '';

    if (!rawFrom || !rawTo) {
      errEl.textContent = 'Introduce ambas fechas.';
      errEl.classList.add('show');
      return;
    }
    let dFrom = dayjs(rawFrom);
    let dTo   = dayjs(rawTo);
    if (!dFrom.isValid() || !dTo.isValid()) {
      errEl.textContent = 'Una o ambas fechas no son válidas.';
      errEl.classList.add('show');
      return;
    }
    if (dFrom.isAfter(dTo)) { [dFrom, dTo] = [dTo, dFrom]; }

    // Build list of ISO weeks from dFrom's week to dTo's week (inclusive)
    const weeks = [];
    let cursor = dFrom.isoWeekday(1); // start of dFrom's ISO week (Monday)
    const endMonday = dTo.isoWeekday(1);

    while (!cursor.isAfter(endMonday)) {
      const thu      = cursor.isoWeekday(4);
      const wYear    = cursor.isoWeekYear();
      const wNum     = cursor.isoWeek();
      const refMonth = thu.month() + 1;
      const refYear  = thu.year();
      const qInfo    = getQ(thu);
      weeks.push({ wNum, wYear, refMonth, refYear, qInfo });
      cursor = cursor.add(7, 'day');
    }

    // ── Summary strip
    const fromInfo = weeks[0];
    const toInfo   = weeks[weeks.length - 1];
    sumEl.innerHTML = `
      <div class="rs-pill sp-weeks">
        <span class="rsp-label">Total semanas</span>
        <span class="rsp-val">${weeks.length}</span>
      </div>
      <div class="rs-pill sp-from">
        <span class="rsp-label">Desde</span>
        <span class="rsp-val">${fromInfo.wYear}-W${String(fromInfo.wNum).padStart(2,'0')}</span>
      </div>
      <div class="rs-pill sp-to">
        <span class="rsp-label">Hasta</span>
        <span class="rsp-val">${toInfo.wYear}-W${String(toInfo.wNum).padStart(2,'0')}</span>
      </div>
    `;

    // ── Week rows
    weeks.forEach((w, i) => {
      const row = document.createElement('div');
      row.className = `wl-row ${w.qInfo.cls}-row`;
      if (i === 0)              row.classList.add('wl-first');
      if (i === weeks.length-1) row.classList.add('wl-last');

      row.innerHTML = `
        <span class="wl-week">W${String(w.wNum).padStart(2,'0')}</span>
        <span class="wl-year">${w.wYear}</span>
        <span class="wl-month">${w.refYear}-${String(w.refMonth).padStart(2,'0')} <span style="font-size:.6rem;opacity:.6">${MONTH_SHORT[w.refMonth]}</span></span>
        <span class="wl-quarter">${w.wYear}-${w.qInfo.label}</span>
      `;
      listEl.appendChild(row);
    });

    // Store for copy
    window._rangeWeeks = weeks;

    // Animate in
    void sumEl.offsetWidth;
    sumEl.classList.add('visible');
    wrapEl.classList.add('visible');
  }

  document.getElementById('btnRange').addEventListener('click', analyzeRange);
  document.getElementById('rangeFrom').addEventListener('keydown', e => { if (e.key === 'Enter') analyzeRange(); });
  document.getElementById('rangeTo').addEventListener('keydown',   e => { if (e.key === 'Enter') analyzeRange(); });

  // Copy JSON button
  document.getElementById('btnCopy').addEventListener('click', () => {
    if (!window._rangeWeeks) return;
    const json = JSON.stringify(
      window._rangeWeeks.map(w => ({
        week:    String(w.wNum),
        year:    String(w.wYear),
        month:   `${w.refYear}-${String(w.refMonth).padStart(2,'0')}`,
        quarter: `${w.wYear}-${w.qInfo.label}`,
      })),
      null, 2
    );
    navigator.clipboard.writeText(json).then(() => {
      const ok = document.getElementById('copyOk');
      ok.classList.add('show');
      setTimeout(() => ok.classList.remove('show'), 2000);
    });
  });

  // Pre-fill range
  const today = dayjs();
  document.getElementById('rangeFrom').value = today.format('YYYY-MM-DD');
  document.getElementById('rangeTo').value   = today.add(8, 'week').format('YYYY-MM-DD');

  /* ═══════════════════════════════════════════
     TAB 3 — ISO TOOLS
  ═══════════════════════════════════════════ */

  // ─── Tool 1: Week Picker Visual ───
  let wpCurrentMonth = dayjs();

  function renderWeekPicker() {
    const cal   = document.getElementById('wpCal');
    const label = document.getElementById('wpMonthLabel');
    const first = wpCurrentMonth.startOf('month');

    label.textContent = `${MONTH_NAMES[wpCurrentMonth.month()+1]} ${wpCurrentMonth.year()}`;

    // Build calendar grid: start from Monday of the week containing first day of month
    let cursor = first.isoWeekday(1);
    if (cursor.isAfter(first)) cursor = cursor.subtract(7, 'day');

    // Header row
    cal.innerHTML = ['L','M','X','J','V','S','D'].map(d => 
      `<div class="wp-header">${d}</div>`
    ).join('');

    // Day cells (6 weeks)
    for (let i = 0; i < 42; i++) {
      const day = document.createElement('div');
      day.className = 'wp-day';
      if (cursor.month() !== wpCurrentMonth.month()) day.classList.add('wp-other-month');
      day.textContent = cursor.date();
      
      const dateStr = cursor.format('YYYY-MM-DD');
      day.dataset.date = dateStr;
      
      // Capture current cursor value in closure
      const clickDate = cursor.clone();
      day.addEventListener('click', () => selectWeek(clickDate));
      
      cal.appendChild(day);
      cursor = cursor.add(1, 'day');
    }
  }

  function selectWeek(d) {
    const monday = d.isoWeekday(1);
    const sunday = monday.add(6, 'day');
    
    document.querySelectorAll('.wp-day').forEach(cell => {
      cell.classList.remove('wp-selected');
      const cellDate = dayjs(cell.dataset.date);
      const cellMonday = cellDate.isoWeekday(1);
      
      if (cellMonday.format('YYYY-MM-DD') === monday.format('YYYY-MM-DD')) {
        cell.classList.add('wp-selected');
      }
    });

    const wNum = d.isoWeek();
    const wYear = d.isoWeekYear();

    const res = document.getElementById('wpResult');
    res.innerHTML = `
      <strong>${wYear}-W${String(wNum).padStart(2,'0')}</strong><br>
      ${monday.format('DD')} ${MONTH_SHORT[monday.month()+1]} – ${sunday.format('DD')} ${MONTH_SHORT[sunday.month()+1]} ${sunday.year()}
    `;
    res.classList.add('show');
  }

  document.getElementById('wpPrev').addEventListener('click', () => {
    wpCurrentMonth = wpCurrentMonth.subtract(1, 'month');
    renderWeekPicker();
  });
  document.getElementById('wpNext').addEventListener('click', () => {
    wpCurrentMonth = wpCurrentMonth.add(1, 'month');
    renderWeekPicker();
  });

  renderWeekPicker();

  // ─── Tool 2: Boundary Weeks Analyzer ───
  function analyzeBoundaryWeeks(year) {
    const list = document.getElementById('boundaryList');
    list.innerHTML = '';

    let cursor = dayjs(`${year}-01-04`).isoWeekday(1);
    const boundaries = [];

    for (let i = 0; i < 54; i++) {
      const wYear = cursor.isoWeekYear();
      if (wYear !== year) { 
        cursor = cursor.add(7, 'day'); 
        continue; 
      }

      const monday = cursor;
      const sunday = cursor.add(6, 'day');
      const wNum = cursor.isoWeek();

      // Check if week crosses month or year boundary
      const crossMonth = monday.month() !== sunday.month();
      const crossYear  = monday.year() !== sunday.year();

      if (crossMonth || crossYear) {
        boundaries.push({ wNum, wYear, monday, sunday, crossMonth, crossYear });
      }

      cursor = cursor.add(7, 'day');
    }

    if (boundaries.length === 0) {
      list.innerHTML = '<div style="padding:.8rem;color:var(--muted);font-size:.7rem;">No hay semanas frontera este año.</div>';
      return;
    }

    boundaries.forEach(b => {
      const item = document.createElement('div');
      item.className = 'boundary-item';
      const reason = b.crossYear ? 'Cruza año calendario' : 'Cruza mes';
      item.innerHTML = `
        <div class="bi-week">${b.wYear}-W${String(b.wNum).padStart(2,'0')}</div>
        <div class="bi-detail">
          ${b.monday.format('DD')} ${MONTH_SHORT[b.monday.month()+1]} – 
          ${b.sunday.format('DD')} ${MONTH_SHORT[b.sunday.month()+1]} ${b.sunday.year()} · ${reason}
        </div>
      `;
      list.appendChild(item);
    });
  }

  document.getElementById('boundYear').addEventListener('input', e => {
    const year = parseInt(e.target.value);
    if (year >= 2020 && year <= 2030) {
      analyzeBoundaryWeeks(year);
    }
  });
  analyzeBoundaryWeeks(2026);

  // ─── Tool 3: Week Range Shortcuts ───
  document.querySelectorAll('.btn-shortcut').forEach(btn => {
    btn.addEventListener('click', () => {
      const range = btn.dataset.range;
      const now = dayjs();
      let from, to;

      if (range === 'thisMonth') {
        // Get current ISO month (based on thursday)
        const thu = now.isoWeekday(4);
        const refMonth = thu.month();
        const refYear = thu.year();
        
        // First and last day of that month
        const firstDay = dayjs(new Date(refYear, refMonth, 1));
        const lastDay  = dayjs(new Date(refYear, refMonth + 1, 0));
        
        from = firstDay;
        to   = lastDay;
      } else if (range === 'q1') {
        from = dayjs(`${now.year()}-01-01`);
        to   = dayjs(`${now.year()}-04-30`);
      } else if (range === 'q2') {
        from = dayjs(`${now.year()}-05-01`);
        to   = dayjs(`${now.year()}-08-31`);
      } else if (range === 'q3') {
        from = dayjs(`${now.year()}-09-01`);
        to   = dayjs(`${now.year()}-12-31`);
      } else if (range === 'last4') {
        to   = now;
        from = now.subtract(3, 'week');
      } else if (range === 'next12') {
        from = now;
        to   = now.add(11, 'week');
      }

      document.getElementById('rangeFrom').value = from.format('YYYY-MM-DD');
      document.getElementById('rangeTo').value   = to.format('YYYY-MM-DD');

      // Switch to tab 1
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      document.querySelector('[data-tab="inspector"]').classList.add('active');
      document.getElementById('panel-inspector').classList.add('active');
      
      // Scroll to range section
      setTimeout(() => {
        document.querySelector('.range-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
    });
  });

  // ─── Tool 4: ISO Week → Dates (Inverse) ───
  document.getElementById('inverseGo').addEventListener('click', () => {
    const input = document.getElementById('inverseInput').value.trim();
    const res   = document.getElementById('inverseResult');

    const match = input.match(/^(\d{4})-?W(\d{1,2})$/i);
    if (!match) {
      res.innerHTML = '<div style="color:#ff7b7b;">Formato inválido. Usa: 2026-W18 o 2026W18</div>';
      res.classList.add('show');
      return;
    }

    const year = parseInt(match[1]);
    const week = parseInt(match[2]);

    if (week < 1 || week > 53) {
      res.innerHTML = '<div style="color:#ff7b7b;">Semana debe estar entre 1 y 53.</div>';
      res.classList.add('show');
      return;
    }

    // Find Monday of ISO W01 for this year
    const jan4 = dayjs(`${year}-01-04`);
    const w1monday = jan4.isoWeekday(1);
    const targetMonday = w1monday.add(week - 1, 'week');

    // Validate that this week belongs to the requested year
    if (targetMonday.isoWeekYear() !== year) {
      res.innerHTML = `<div style="color:#ff7b7b;">La semana ${week} no pertenece al año ISO ${year}.</div>`;
      res.classList.add('show');
      return;
    }

    const sunday = targetMonday.add(6, 'day');
    const thu = targetMonday.isoWeekday(4);
    const qInfo = getQ(thu);
    
    res.innerHTML = `
      <div class="ir-label">Lunes – Domingo</div>
      <div class="ir-value">
        ${targetMonday.format('DD')} ${MONTH_SHORT[targetMonday.month()+1]} ${targetMonday.year()} – 
        ${sunday.format('DD')} ${MONTH_SHORT[sunday.month()+1]} ${sunday.year()}
      </div>
      <div class="ir-label" style="margin-top:.4rem;">Mes ISO (jueves)</div>
      <div class="ir-value">${thu.year()}-${String(thu.month()+1).padStart(2,'0')} · ${qInfo.label}</div>
    `;
    res.classList.add('show');
  });
  
  document.getElementById('inverseInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') document.getElementById('inverseGo').click();
  });

  // ─── Tool 5: Validator ───
  document.getElementById('validatorGo').addEventListener('click', () => {
    const input = document.getElementById('validatorInput').value;
    const res   = document.getElementById('validatorResult');

    const lines = input.split('\n').map(l => l.trim()).filter(Boolean);
    if (lines.length === 0) {
      res.innerHTML = '<div style="color:var(--muted);padding:.5rem;">Introduce semanas ISO para validar (una por línea).</div>';
      res.classList.add('show');
      return;
    }

    const valid = [], invalid = [], warnings = [];
    const seen = new Set();

    lines.forEach((line, idx) => {
      const match = line.match(/^(\d{4})-?W(\d{1,2})$/i);
      if (!match) {
        invalid.push(`Línea ${idx+1}: "${line}" — formato inválido`);
        return;
      }

      const year = parseInt(match[1]);
      const week = parseInt(match[2]);

      if (week < 1 || week > 53) {
        invalid.push(`Línea ${idx+1}: ${line} — semana fuera de rango`);
        return;
      }

      // Check if week exists
      const jan4 = dayjs(`${year}-01-04`);
      const w1monday = jan4.isoWeekday(1);
      const targetMonday = w1monday.add(week - 1, 'week');
      
      if (targetMonday.isoWeekYear() !== year) {
        invalid.push(`Línea ${idx+1}: ${line} — no existe en año ISO ${year}`);
        return;
      }

      const normalized = `${year}-W${String(week).padStart(2,'0')}`;
      if (seen.has(normalized)) {
        warnings.push(`${normalized} — duplicado`);
      }
      seen.add(normalized);
      valid.push(normalized);
    });

    // Check for gaps (only if 2+ valid weeks)
    if (valid.length >= 2) {
      const sorted = valid.map(v => {
        const m = v.match(/^(\d{4})-W(\d{1,2})$/);
        return { str: v, year: parseInt(m[1]), week: parseInt(m[2]) };
      }).sort((a,b) => {
        if (a.year !== b.year) return a.year - b.year;
        return a.week - b.week;
      });

      for (let i = 1; i < sorted.length; i++) {
        const prev = sorted[i-1];
        const curr = sorted[i];
        
        if (curr.year === prev.year) {
          if (curr.week > prev.week + 1) {
            const gap = curr.week - prev.week - 1;
            warnings.push(`Gap de ${gap} semana(s) entre ${prev.str} y ${curr.str}`);
          }
        }
      }
    }

    res.innerHTML = '';
    
    if (valid.length > 0) {
      res.innerHTML += `
        <div class="vr-section vr-valid">
          <div class="vr-title">✓ Válidas (${valid.length})</div>
          <ul class="vr-list">${valid.slice(0,8).map(v => `<li>${v}</li>`).join('')}</ul>
          ${valid.length > 8 ? `<div style="color:var(--muted);font-size:.6rem;margin-top:.3rem;">...y ${valid.length-8} más</div>` : ''}
        </div>
      `;
    }
    
    if (invalid.length > 0) {
      res.innerHTML += `
        <div class="vr-section vr-invalid">
          <div class="vr-title">✗ Inválidas (${invalid.length})</div>
          <ul class="vr-list">${invalid.map(v => `<li>${v}</li>`).join('')}</ul>
        </div>
      `;
    }
    
    if (warnings.length > 0) {
      res.innerHTML += `
        <div class="vr-section vr-info">
          <div class="vr-title">⚠ Advertencias (${warnings.length})</div>
          <ul class="vr-list">${warnings.map(v => `<li>${v}</li>`).join('')}</ul>
        </div>
      `;
    }
    
    res.classList.add('show');
  });

  // ─── Tool 6: Year Week Count ───
  function buildYearWeekCountTable() {
    const table = document.getElementById('ywcTable');
    let html = '<thead><tr><th>Año</th><th>Semanas ISO</th></tr></thead><tbody>';

    for (let year = 2020; year <= 2030; year++) {
      let cursor = dayjs(`${year}-01-04`).isoWeekday(1);
      let count = 0;
      
      for (let i = 0; i < 54; i++) {
        if (cursor.isoWeekYear() === year) count++;
        cursor = cursor.add(7, 'day');
      }
      
      const cls = count === 53 ? ' class="ywc-53"' : '';
      html += `<tr><td>${year}</td><td${cls}>${count}</td></tr>`;
    }

    html += '</tbody>';
    table.innerHTML = html;
  }
  buildYearWeekCountTable();

  /* ───── Tab 2 — Calendar ───── */
  function fmt(d) { return `${String(d.date()).padStart(2,'0')} ${MONTH_SHORT[d.month()+1]}`; }

  function buildCalendar(year) {
    const tbody    = document.getElementById('calBody');
    const todayW   = dayjs().isoWeek();
    const todayWY  = dayjs().isoWeekYear();

    tbody.innerHTML = '';

    // Find Monday of ISO W01 of `year`
    let cursor  = dayjs(`${year}-01-04`).isoWeekday(1);
    let prevQ   = null;

    for (let i = 0; i < 54; i++) {
      const thursday = cursor.isoWeekday(4);
      const wYear    = cursor.isoWeekYear();
      const wNum     = cursor.isoWeek();

      if (wYear !== year) { cursor = cursor.add(7, 'day'); continue; }

      const sunday   = cursor.add(6, 'day');
      const refMonth = thursday.month() + 1;
      const refYear  = thursday.year();
      const qInfo    = getQ(thursday);
      const isToday  = (wYear === todayWY && wNum === todayW);
      const isQStart = qInfo.label !== prevQ;
      prevQ = qInfo.label;

      const tr = document.createElement('tr');
      tr.className = `${qInfo.cls}-row`;
      if (isToday)  tr.classList.add('today-row');
      if (isQStart) tr.classList.add(`${qInfo.cls}-start`);

      tr.innerHTML = `
        <td>
          <span class="td-week-iso">ISO</span>
          <span class="td-week-num">${year}-W${String(wNum).padStart(2,'0')}</span>
        </td>
        <td class="td-range">${fmt(cursor)} – ${fmt(sunday)}</td>
        <td class="td-thu">${fmt(thursday)}</td>
        <td class="td-month">
          ${refYear}-${String(refMonth).padStart(2,'0')}
          <span class="td-month-name">${MONTH_SHORT[refMonth]}</span>
        </td>
        <td class="td-quarter">${year}-${qInfo.label}</td>
      `;

      tbody.appendChild(tr);
      cursor = cursor.add(7, 'day');
    }
  }

  document.querySelectorAll('.cal-year-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.cal-year-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      buildCalendar(parseInt(btn.dataset.year));
    });
  });

  buildCalendar(2026);
</script>
</body>
</html>